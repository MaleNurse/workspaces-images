#!/bin/bash

have_ranger=$(type -p ranger)

choose_image() {
  TMP="$(mktemp)"
  ranger --choosefile="${TMP}" "/share" 1>&2
  cat ${TMP}
  rm -f ${TMP}
}

selectedApp=
[ "$1" ] && {
  [ -f "$1" ] && {
    file "$1" | grep executable > /dev/null && {
      selectedApp="$1"
    }
  }
}

[ "${selectedApp}" ] || {
  if [ "${have_ranger}" ]; then
    selectedApp="$(choose_image)"
  else
    selectedApp=$(dialog --stdout \
                         --title "Please select an AppImage file" \
                         --fselect /share/ 14 48)
  fi
}

[ -f "${selectedApp}" ] && AppImageLauncher "${selectedApp}"
